use num::bigint::BigUint;
use num_traits::Zero;

macro_rules! Number {
    ($e: expr) => {
        BigUint::parse_bytes(String::from($e).as_bytes(), 10).unwrap();
    };
}

#[cfg(test)]
mod test_number_macro {
    use super::*;

    #[test]
    fn miniscule() {
        let a = Number!("0");
        let b = BigUint::parse_bytes(b"0", 10).unwrap();
        assert_eq!(a, b);
    }

    #[test]
    fn tiny() {
        let a = Number!("10");
        let b = BigUint::parse_bytes(b"10", 10).unwrap();
        assert_eq!(a, b);
    }

    #[test]
    fn small() {
        let a = Number!("123");
        let b = BigUint::parse_bytes(b"123", 10).unwrap();
        assert_eq!(a, b);
    }

    #[test]
    fn medium() {
        let a = Number!("123456789");
        let b = BigUint::parse_bytes(b"123456789", 10).unwrap();
        assert_eq!(a, b);
    }

    #[test]
    fn large() {
        let a = Number!("123456789123456789");
        let b = BigUint::parse_bytes(b"123456789123456789", 10).unwrap();
        assert_eq!(a, b);
    }

    #[test]
    fn x_large() {
        let a = Number!("123456789123456789123456789123456789123456789123456789");
        let b = BigUint::parse_bytes(
            b"123456789123456789123456789123456789123456789123456789",
            10,
        ).unwrap();
        assert_eq!(a, b);
    }

    #[test]
    fn xx_large() {
        let a = Number!("123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789");
        let b = BigUint::parse_bytes(b"123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789", 10).unwrap();
        assert_eq!(a, b);
    }

    #[test]
    fn xxx_large() {
        let a = Number!("123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789");
        let b = BigUint::parse_bytes(b"123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789123456789", 10).unwrap();
        assert_eq!(a, b);
    }
}

pub fn gcd(a: BigUint, b: BigUint) -> BigUint {
    let mut x = a;
    let mut y = b;

    while y != Zero::zero() {
        let r = x % y.clone();
        x = y;
        y = r;
    }
    return x;
}

#[cfg(test)]
mod test_gcd {
    use super::*;

    #[test]
    fn miniscule() {
        let a = Number!("10");
        let b = Number!("5");
        let expected = Number!("5");
        assert_eq!(gcd(a, b), expected);
    }

    #[test]
    fn tiny() {
        let a = Number!("29943");
        let b = Number!("29738");
        let expected = Number!("1");
        assert_eq!(gcd(a, b), expected);
    }

    #[test]
    fn small() {
        let a = Number!("299429203");
        let b = Number!("827382738");
        let expected = Number!("1");
        assert_eq!(gcd(a, b), expected);
    }

    #[test]
    fn medium() {
        let a = Number!("1672976127961212891");
        let b = Number!("3378278237328723873");
        let expected = Number!("3");
        assert_eq!(gcd(a, b), expected);
    }

    #[test]
    fn large() {
        let a = Number!("16729761279612128911672976127961212891");
        let b = Number!("33782782373287238731672976127961212891");
        let expected = Number!("3");
        assert_eq!(gcd(a, b), expected);
    }

    #[test]
    fn x_large() {
        let a = Number!(
            "1873817317893712873298173982173982173897128738912738217371897381374891378943789"
        );
        let b = Number!(
            "9188937128738173912371837981739817238917246812647812678394619836281693618963297"
        );
        let expected = Number!("1");
        assert_eq!(gcd(a, b), expected);
    }

    #[test]
    fn xx_large() {
        let a = Number!("18273781798371987398173891273871293762178362308763217863871263826817067830612083612876307916239721638916398216398613892168903681293610639120368219732891372189361287361986371863218763017236270362896319038213");
        let b = Number!("82726226362376138712678923161327863279136912363261786391287273961273967239678123623623672369236872671268723672167267612727198623872637892632186267386219627823169783627819623761983627816378263178639821687326");
        let expected = Number!("1");
        assert_eq!(gcd(a, b), expected);
    }

    #[test]
    fn xxx_large() {
        let a = Number!("1827378179837198739817389127387129376217836230876321786387126382681706783061208361287630791623972163891639821639861389216890368129361063912036821973289137218936128736198637186321876301723627036289631903821318273781798371987398173891273871293762178362308763217863871263826817067830612083612876307916239721638916398216398613892168903681293610639120368219732891372189361287361986371863218763017236270362896319038213");
        let b = Number!("8272622636237613871267892316132786327913691236326178639128727396127396723967812362362367236923687267126872367216726761272719862387263789263218626738621962782316978362781962376198362781637826317863982168732618273781798371987398173891273871293762178362308763217863871263826817067830612083612876307916239721638916398216398613892168903681293610639120368219732891372189361287361986371863218763017236270362896319038213");
        let expected = Number!("1");
        assert_eq!(gcd(a, b), expected);
    }
}
